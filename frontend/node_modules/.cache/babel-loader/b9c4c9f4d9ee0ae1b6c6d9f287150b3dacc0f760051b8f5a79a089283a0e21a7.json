{"ast":null,"code":"/// provides the async helper functionality\n\nfunction Waiter() {\n  if (!(this instanceof Waiter)) {\n    return new Waiter();\n  }\n  var self = this;\n\n  // found values\n  self.values = {};\n\n  // callback when done\n  self.callback = null;\n  self.resolved = false;\n  self.count = 0;\n}\n;\nWaiter.prototype.wait = function () {\n  var self = this;\n  ++self.count;\n};\n\n// resolve the promise\nWaiter.prototype.resolve = function (name, val) {\n  var self = this;\n  self.values[name] = val;\n\n  // done with all items\n  if (--self.count === 0) {\n    self.resolved = true;\n\n    // we may not have a done callback yet\n    if (self.callback) {\n      self.callback(self.values);\n    }\n  }\n};\n\n// sets the done callback for the waiter\n// notifies when the promise is complete\nWaiter.prototype.done = function (fn) {\n  var self = this;\n  self.callback = fn;\n  if (self.resolved) {\n    fn(self.values);\n  }\n};\nvar alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_';\nvar gen_id = function () {\n  var res = '';\n  for (var i = 0; i < 8; ++i) {\n    res += alphabet[Math.floor(Math.random() * alphabet.length)];\n  }\n  return res;\n};\nmodule.exports = function () {\n  // baton which contains the current\n  // set of deferreds\n  var waiter;\n  var obj = Object.create(null);\n  obj.done = function done(fn) {\n    // no async things called\n    if (!waiter) {\n      return fn({});\n    }\n    waiter.done(fn);\n\n    // clear the waiter for the next template\n    waiter = undefined;\n  };\n  obj.resolve = function resolve(fn, args) {\n    // we want to do async things, need a waiter for that\n    if (!waiter) {\n      waiter = new Waiter();\n    }\n    var id = '__' + gen_id() + '__';\n    var cur_waiter = waiter;\n    waiter.wait();\n    args = [].slice.call(args);\n    args.push(function (res) {\n      cur_waiter.resolve(id, res);\n    });\n    fn.apply(null, args);\n\n    // return the id placeholder\n    // this will be replaced later\n    return id;\n  };\n  return obj;\n};","map":{"version":3,"names":["Waiter","self","values","callback","resolved","count","prototype","wait","resolve","name","val","done","fn","alphabet","gen_id","res","i","Math","floor","random","length","module","exports","waiter","obj","Object","create","undefined","args","id","cur_waiter","slice","call","push","apply"],"sources":["/Users/malikashahi/node_modules/hbs/lib/async.js"],"sourcesContent":["/// provides the async helper functionality\n\nfunction Waiter() {\n    if (!(this instanceof Waiter)) {\n        return new Waiter();\n    }\n\n    var self = this;\n\n    // found values\n    self.values = {};\n\n    // callback when done\n    self.callback = null;\n\n    self.resolved = false;\n\n    self.count = 0;\n};\n\nWaiter.prototype.wait = function() {\n    var self = this;\n    ++self.count;\n};\n\n// resolve the promise\nWaiter.prototype.resolve = function(name, val) {\n    var self = this;\n\n    self.values[name] = val;\n\n    // done with all items\n    if (--self.count === 0) {\n        self.resolved = true;\n\n        // we may not have a done callback yet\n        if (self.callback) {\n            self.callback(self.values);\n        }\n    }\n};\n\n// sets the done callback for the waiter\n// notifies when the promise is complete\nWaiter.prototype.done = function(fn) {\n    var self = this;\n\n    self.callback = fn;\n    if (self.resolved) {\n        fn(self.values);\n    }\n};\n\nvar alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_';\n\nvar gen_id = function() {\n    var res = '';\n    for (var i=0 ; i<8 ; ++i) {\n        res += alphabet[Math.floor(Math.random() * alphabet.length)];\n    }\n\n    return res;\n};\n\nmodule.exports = function() {\n    // baton which contains the current\n    // set of deferreds\n    var waiter;\n\n    var obj = Object.create(null);\n    obj.done = function done(fn) {\n        // no async things called\n        if (!waiter) {\n            return fn({});\n        }\n\n        waiter.done(fn);\n\n        // clear the waiter for the next template\n        waiter = undefined;\n    };\n\n    obj.resolve = function resolve(fn, args) {\n        // we want to do async things, need a waiter for that\n        if (!waiter) {\n            waiter = new Waiter();\n        }\n\n        var id = '__' + gen_id() + '__';\n\n        var cur_waiter = waiter;\n        waiter.wait();\n\n        args = [].slice.call(args);\n        args.push(function(res) {\n            cur_waiter.resolve(id, res);\n        })\n\n        fn.apply(null, args);\n\n        // return the id placeholder\n        // this will be replaced later\n        return id;\n    };\n\n    return obj;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}